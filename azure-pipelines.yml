trigger:
  - azure
pool:
  vmImage: 'ubuntu-latest'
container:
  image: argosnotary/argosbuild-argos4j-cli-snapshot:upgrade-argos4j
steps:
  - script: |
      postLink --phase pre --segment azure --step build --runId $BUILD_NUMBER
      export JAVA_HOME=/usr/local/openjdk-8; mvn -q --global-toolchains /etc/toolchains.xml -s settings.xml clean install xldeploy:import -Drevision=$(Build.SourceVersion) -Dxldeploy.server=xldeploy.argosnotary.org -Dxldeploy.port=80
      export JAVA_HOME=/usr/local/openjdk-11; postLink --phase post --segment azure --step build --runId $BUILD_NUMBER
    env:
      WORKSPACE: $(System.DefaultWorkingDirectory)
      BUILD_NUMBER: $(Build.BuildNumber)
      ARGOS_SERVICE_BASE_URL: https://notary.argosnotary.org/api
      CREDENTIALS_PASSPHRASE: $(credentials-pw)
      CREDENTIALS_KEY_ID: $(credentials-key-id)
      SUPPLY_CHAIN_NAME: argos-test-app
      SUPPLY_CHAIN_PATH: rabobank
    name: build
